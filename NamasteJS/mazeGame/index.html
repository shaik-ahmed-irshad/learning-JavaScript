<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Ahmed's personal portfolio website showcasing all his works">
    <meta name="keywords" content="HTML, CSS, JavaScript">
    <meta name="author" content="Irsh">
    <title>Maze Game</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="styles.css">
    <style>
     
    </style>
  </head>
  <body>
    <center>
      <div>
        <h1 id="gameName">Welcome to Maze ka Game</h1>
        <h1 id="score">Attempts took to win: <span id="displayCount">0</span></h1>
        <table id="gameEndImg">
          <tbody id="game"></tbody>
        </table>
       
      </div>
    </center>
  </body>
  <script>
    // creating local storage
    if(!localStorage.getItem('winners')){
      localStorage.setItem('winners', JSON.stringify([]))
    }


    // import audio
    const audio = new Audio('boom.wav')
    const win = new Audio('win.wav')
    const loser = new Audio('loser.wav')
    
    

    // variables
    let playerName = prompt(`Enter your Game Name: `)
    let table = document.getElementById("game");
    let row, col, score, counter = 0 ;
    let primes = [2,3,5,7,11,13]
    let attempts = 0
    let visitedCells = []

    // 1.0: initialize array of 100 and adding numbers 1-100 in the table
    const tableData = new Array(100)
    for(i=0;i<tableData.length;i++){
        tableData[i] = i+1
    }
    // 1.1: random sorting the table
    tableData.sort((a,b) => Math.random() - 0.5)

    document.getElementById('displayCount').innerText = attempts
    document.getElementById('gameName').innerText = `Welcome abord ${playerName}!!ðŸ˜»`
    // 1.2 logic to create table rows and columns

    // adding rows
    for (i = 1; i <= 10; i++) {
      row = document.createElement("tr");
      // adding columns
      for (j = 1; j <= 10; j++) {
        col = document.createElement("td");
        col.id = tableData[counter]
        col.addEventListener("click", function(event) {
            let targetElement = event.target.id
            // game lost logic
            if(primes.includes(+targetElement)){
              loser.play()
              alert( `Game Over: You are a lost cause buddy`);
              document.getElementById('gameEndImg').style.backgroundColor =  `#fb6161`
              loser.play()
              location.reload('/')    
            }
            //game win logic
            else if(+targetElement == 1){
                document.getElementById('displayCount').innerText = ++attempts;
                win.play() ; document.getElementById('gameEndImg').style.backgroundColor =  `#61fb6b`;
                alert( `Jeet gaye yaro tum... ${attempts} attempt me`);
                let data = JSON.parse(localStorage.getItem('winners'))
                let newWinner = {playerName, attempts}
                let newWinners = newRankings(data, newWinner)
                localStorage.setItem('winners', JSON.stringify(newWinners))
                location.replace('leaderboard.html')
            }
            else {
                  if(visitedCells.includes(+targetElement)){
                    loser.play()
                    console.log(visitedCells, targetElement);
                    return alert(`Its alreay visited`)
                  } 
                  audio.play()
                  document.getElementById('displayCount').innerText = ++attempts
                  for(let k=targetElement;k<=100;k++){
                      if(k % targetElement == 0) {
                        document.getElementById(k).style.backgroundColor =  `#61dafb`
                        visitedCells.push(+k)
                      }
                  }
            }
        })
        counter++
        row.appendChild(col);
      }
      table.appendChild(row);

    }

    
  function newRankings(winnerData, newWinner) {
    const newWinners = [];
    let temp = [];
    winnerData = winnerData.flat()
    winnerData.push(newWinner);
    winnerData.sort((a, b) => a.attempts - b.attempts);

    temp[0] = winnerData[0];

    for (let i = 1; i < winnerData.length; i++) {
      if (winnerData[i].attempts == winnerData[i - 1].attempts) {
        temp.push(winnerData[i]);
      } else {
        newWinners.push(temp);
        temp = [];
        temp.push(winnerData[i]);
      }
    }
    newWinners.push(temp);
    return newWinners;
  }

    
    // Game over logic
    
   


    // 2.1 logic to display number of attempts to win
    // let attempts = 0
    // // increase attempt count function
    // const attempts = () => {
    //   return attempts++
    // }
    // // display attempts count function
    // const displayAttempts = () => {
    //   document.getElementById('displayCount').innerText = attempts 
    // }
    // // accessing clicked element and adding click event listner; and running attempt count logic in it
    // const incrementCount = document.getElementById("game");
    // incrementCount.addEventListener('click', (event)=> {
    //   attempts()
    //   displayAttempts()
    // })
    

   

    // ---------------
   
  </script>
</html>





